"use strict";(("undefined"!=typeof self?self:this).webpackChunkUePage=("undefined"!=typeof self?self:this).webpackChunkUePage||[]).push([[603],{8603:(t,e,s)=>{s.r(e),s.d(e,{dealFormMessage:()=>u,serializeForm:()=>l});var i=s(9061),o=(s(9375),s(2438),s(2266),s(9819),s(4893)),r=s(403),n=s(4651);const a={"zh-CN":{REQUIRE_ERR_MSG:"此项不能为空",NUMBER_ERR_MSG:"只能输入数字",EMAIL_ERR_MSG:"请输入正确的邮箱",PHONE_ERR_MSG:"请输入正确的手机号",DATE_ERR_MSG:"请输入正确的时间，格式为 2018-09-10 或者 2018-09-10 21:09",CHECK_FORM:"请检查表单后重新提交",SUCCESS:"提交成功",ERROR:"提交失败，出现未知错误",AGREEMENT_ERR_MSG:"请阅读并同意协议",UPLOAD_ERR_MSG:"上传失败",UPLOAD_CONFIG_ERR_MSG:"未配置附件上传处理器",UPLOAD_FILE_SIZE_ERR_MSG:"文件大小不能超过{{size}}",UPLOADING_ERR_MSG:"正在上传中，请稍后",CODE:"验证码"},"en-US":{REQUIRE_ERR_MSG:"This item cannot be empty",NUMBER_ERR_MSG:"Only numbers can be entered",EMAIL_ERR_MSG:"Please enter the correct email",PHONE_ERR_MSG:"Please enter the correct mobile phone number",DATE_ERR_MSG:"Please enter the correct time, the format is 2018-09-10 or 2018-09-10 21:09",CHECK_FORM:"Please check the form and submit it again",SUCCESS:"Submitted successfully",ERROR:"Submission failed, unknown error",AGREEMENT_ERR_MSG:"Please read and agree to the agreement",UPLOAD_ERR_MSG:"Upload failed",UPLOAD_CONFIG_ERR_MSG:"Upload processor not configured",UPLOAD_FILE_SIZE_ERR_MSG:"File size cannot exceed {{size}}",UPLOADING_ERR_MSG:"Uploading, please wait",CODE:"Verification code"}},c={require:{test:/\S+/,errMsg:"REQUIRE_ERR_MSG"},agreement:{test:/\S+/,errMsg:"AGREEMENT_ERR_MSG"},number:{test:/^[0-9]+$/,errMsg:"NUMBER_ERR_MSG"},email:{test:/^\w+((.\w+)|(-\w+))@[A-Za-z0-9]+((.|-)[A-Za-z0-9]+).[A-Za-z0-9]+$/,errMsg:"EMAIL_ERR_MSG"},phone:{test:/^[1][3,4,5,7,8][0-9]{9}$/,errMsg:"PHONE_ERR_MSG"},date:{test:/^[0-9]{4}-[0-9]{2}-[0-9]{2}(\s[0-9]{2}:[0-9]{2})?$/,errMsg:"DATE_ERR_MSG"}};function d(t){return t instanceof File?t.name:Array.isArray(t)?t.join(", "):String(t)}function l(t){const e=new FormData(t),s={};for(const[i,o]of e.entries())if(o instanceof File){if(!o.name&&0===o.size)continue;const e=t.querySelector(`[name="${i}"]`);if("file"===e?.type&&e.multiple){const t=Array.from(e.files??[]);t.length&&(s[i]=t)}else s[i]=o}else{const t=s[i];void 0!==t?Array.isArray(t)?t.push(o):s[i]=[t,o]:s[i]=o}return s}function h(t){const e=Math.floor(Math.log(t)/Math.log(1024)),s=(t/Math.pow(1024,e)).toFixed(2),i=["Bytes","KB","MB","GB","TB"][e];let o="";return o=s.endsWith(".00")?`${parseInt(s)}${i}`:`${s}${i}`,o}class m{constructor(t,e={}){(0,i.A)(this,"dom",void 0),(0,i.A)(this,"userParam",void 0),(0,i.A)(this,"i18n",void 0),(0,i.A)(this,"waiting",!1),(0,i.A)(this,"eventBus",(0,o.A)()),this.dom=t,this.userParam=this.createUserParam(e),this.i18n=this.getI18nConfig(e.lang),this.init()}createUserParam(t){return{getCodeImgUrl:()=>"",formSubmit:()=>Promise.resolve(),...t}}getI18nConfig(t){return a[t||"zh-CN"]||a["zh-CN"]}init(){this.initCodeImage(),this.initUploadComponent(),this.initFormValidation(),this.initSubmitButton(),this.updateCodeLabel()}initCodeImage(){const t=n(this.dom).find(`.${r.A["form-code-img"]}`),e=t.attr("src"),s=()=>{const e=this.userParam.getCodeImgUrl();e&&t.attr("src",e)};s();const i=()=>s();t.on("click",i),this.eventBus.on("destroy",(()=>{t.off("click",i),t.attr("src",e||"")}))}initUploadComponent(){const t=n(this.dom).find(`.${r.A["form-row"]}[data-type="attachment"]`);if(!t.length)return;const e=this.userParam.uploadFile?.limitSize||5242880;t.each(((t,s)=>{this.userParam.uploadFile?.handler?this.setupUploadRow(s,e):this.showFormMessage(s,{type:"warn",msg:this.i18n.UPLOAD_CONFIG_ERR_MSG})}))}setupUploadRow(t,e){let s=!1;const i=n(t).find("input[type='text']"),o=n(t).find("input[type='file']"),a=n(t).find(`.${r.A["upload-area"]}`);n(t).find(`.${r.A["upload-detail"]} .${r.A.tip}`).text(`PDF, MP4, JPG or RAR (Max ${h(e)})`);const c=t=>{t.stopPropagation()},d=()=>{o.trigger("click")},l=o=>{const c=o.target.files?.[0];if(!c||s)return;if(c.size>e)return void this.showFormMessage(t,{type:"warn",msg:this.i18n.UPLOAD_FILE_SIZE_ERR_MSG.replace("{{size}}",h(e))});this.clearFormMessages(t),s=!0,n(t).attr("data-uploading","true");const d=this.createFileUploadBox(c,a),l=this.userParam.uploadFile?.handler(c,{uploadError:e=>{a.attr("data-state","error"),this.showFormMessage(t,{type:"warn",msg:e||this.i18n.UPLOAD_ERR_MSG})},uploadSuccess:e=>{a.attr("data-state","success"),i.val(e),this.clearFormMessages(t)},uploadProgress:t=>{a.css("--progress",t),d.find(`.${r.A["upload-progress"]}`).text(`${Math.round(100*t)}%`)},uploadFinally:()=>{s=!1,n(t).removeAttr("data-uploading")}});d.one("click",`.${r.A.btn}`,(e=>{e.stopPropagation(),s&&l?.abort(),s=!1,n(t).removeAttr("data-uploading"),this.resetUploadState(t,d,a,i)}))};n(t).on("click",`.${r.A.placeholder}`,d),o.on("click",c).on("change",l),this.eventBus.on("destroy",(()=>{o.off("click",c).off("change",l),n(t).off("click",`.${r.A.placeholder}`,d)}))}createFileUploadBox(t,e){const s=`\n            <div class="${r.A["file-upload-box"]}">\n                <div class="${r.A["file-icon"]}"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <path d="M14 2.26946V6.4C14 6.96005 14 7.24008 14.109 7.45399C14.2049 7.64215 14.3578 7.79513 14.546 7.89101C14.7599 8 15.0399 8 15.6 8H19.7305M20 9.98822V17.2C20 18.8802 20 19.7202 19.673 20.362C19.3854 20.9265 18.9265 21.3854 18.362 21.673C17.7202 22 16.8802 22 15.2 22H8.8C7.11984 22 6.27976 22 5.63803 21.673C5.07354 21.3854 4.6146 20.9265 4.32698 20.362C4 19.7202 4 18.8802 4 17.2V6.8C4 5.11984 4 4.27976 4.32698 3.63803C4.6146 3.07354 5.07354 2.6146 5.63803 2.32698C6.27976 2 7.11984 2 8.8 2H12.0118C12.7455 2 13.1124 2 13.4577 2.08289C13.7638 2.15638 14.0564 2.27759 14.3249 2.44208C14.6276 2.6276 14.887 2.88703 15.4059 3.40589L18.5941 6.59411C19.113 7.11297 19.3724 7.3724 19.5579 7.67515C19.7224 7.94356 19.8436 8.2362 19.9171 8.5423C20 8.88757 20 9.25445 20 9.98822Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n</svg></div>\n                <div class="${r.A["file-name"]}">\n                    <span class="${r.A.text}">${t.name}</span>\n                    <div class="${r.A.btn}"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <path d="M16 6V5.2C16 4.0799 16 3.51984 15.782 3.09202C15.5903 2.71569 15.2843 2.40973 14.908 2.21799C14.4802 2 13.9201 2 12.8 2H11.2C10.0799 2 9.51984 2 9.09202 2.21799C8.71569 2.40973 8.40973 2.71569 8.21799 3.09202C8 3.51984 8 4.0799 8 5.2V6M10 11.5V16.5M14 11.5V16.5M3 6H21M19 6V17.2C19 18.8802 19 19.7202 18.673 20.362C18.3854 20.9265 17.9265 21.3854 17.362 21.673C16.7202 22 15.8802 22 14.2 22H9.8C8.11984 22 7.27976 22 6.63803 21.673C6.07354 21.3854 5.6146 20.9265 5.32698 20.362C5 19.7202 5 18.8802 5 17.2V6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n</svg></div>\n                </div>\n                <div class="${r.A["file-size"]}">${h(t.size)}</div>\n                <div class="${r.A["upload-state"]}">\n                    <div class="${r.A["upload-progress-bar"]}">\n                        <div class="${r.A["upload-progress-bar--inner"]}"></div>\n                    </div>\n                    <div class="${r.A["upload-progress"]}">0%</div>\n                </div>\n            </div>\n        `;return n(s).appendTo(e.attr("data-has-file","true"))}resetUploadState(t,e,s,i){this.clearFormMessages(t),e.remove(),s.attr("data-has-file","false").removeAttr("data-state"),i.val("")}initFormValidation(){}initSubmitButton(){const t=n(this.dom).find(`.${r.A["submit-btn"]}`),e=()=>this.handleSubmit();t.on("click",e),this.eventBus.on("destroy",(()=>{t.off("click",e)}))}updateCodeLabel(){const t=n(`.${r.A["form-row"]}[data-type="code"]`).find(`.${r.A["form-row_name"]}`),e=t.text();t.text("验证码"===e?this.i18n.CODE:e)}showFormMessage(t,e){const s=r.A["form-msg"],i=n(t).find(`.${s}`),{msg:o,type:a}=e;o&&(i.length?i.text(o):n(`<div class="${s}" data-type="${a}">${o}</div>`).appendTo(t))}clearFormMessages(t){t?n(t).find(`.${r.A["form-msg"]}`).remove():n(this.dom).find(`.${r.A["form-msg"]}`).remove()}changeFormStatus(t){const e=n(this.dom).find(`.${r.A["form-row--submit"]}`);t?e.attr("data-status",t):e.removeAttr("data-status")}checkInputValue(){this.clearFormMessages(),this.changeFormStatus();const t=n(this.dom).find(`.${r.A["form-row"]}`);let e=!0;return t.each(((t,s)=>{const i=n(s).find("input,select,textarea").filter(((t,e)=>!!n(e).attr("name")));if(!i.length)return;const o=function(t){const e=t.eq(0).attr("type");return"checkbox"===e?String(t.filter("input[type='checkbox']:checked").val()||""):"radio"===e?String(t.filter("input[type='radio']:checked").val()||""):(t.val()||"").toString().trim()}(i),r=n(s).data("ruler")?.toString().split(",")||[];if("true"===n(s).attr("data-uploading"))return e=!1,void this.showFormMessage(s,{type:"warn",msg:this.i18n.UPLOADING_ERR_MSG});if(r.includes("require"))for(const t of r){const i=c[t];if(i){if(!i.test.test(o.trim())){e=!1,this.showFormMessage(s,{type:"warn",msg:this.i18n[i.errMsg]});break}}}})),e}handleSubmit(){if(this.waiting)return;if(!this.checkInputValue()){const t=n(this.dom).find(`.${r.A["form-row--submit"]}`);return void this.showFormMessage(t[0],{type:"warn",msg:this.i18n.CHECK_FORM})}this.waiting=!0,this.changeFormStatus("loading");const t=l(this.dom),e=function(t){const e={code:"",type:"",content:"<style>table{border-right:#cccccc 1px solid;border-bottom:#cccccc 1px solid;}tr{ margin:0; padding:0}td,th{ border-left:#cccccc 1px solid;border-top:#cccccc 1px solid; margin:0; padding:0 10px; font-size:14px; background:#f8f8f8; color:#666; line-height:30px}</style>"};if("object"!=typeof t||null===t)return e;e.content+='<table width="600" border="0" cellspacing="0"><tbody>';for(const[s,i]of Object.entries(t)){const t=d(i);"code"===s?e.code=t:"type"===s?e.type=t:e.content+=`<tr><th>${s}</th><td>${t}</td></tr>`}return e.content+="</tbody></table>",e.content+=`<p style="color:#666; font-size:12px">来自&nbsp;&nbsp;${window.location.host}</p>`,e}(t),s=n(this.dom).attr("data-name")||"";this.userParam.formSubmit(t,e,{formName:s}).then((()=>{const t=n(this.dom).find(`.${r.A["form-row--submit"]}`);this.showFormMessage(t[0],{type:"success",msg:this.i18n.SUCCESS}),this.changeFormStatus("success")})).catch((t=>{this.changeFormStatus("error");const e=n(this.dom).find(`.${r.A["form-row--submit"]}`);this.showFormMessage(e[0],{type:"warn",msg:t||this.i18n.ERROR})})).finally((()=>{this.waiting=!1;const t=n(this.dom).find(`.${r.A["form-code-img"]}`),e=this.userParam.getCodeImgUrl();e&&t.attr("src",e)}))}destroy(){this.waiting=!1,this.changeFormStatus(),this.clearFormMessages(),this.eventBus.emit("destroy"),this.eventBus.all.clear()}}function u(t,e={}){const s=new m(t,e);return{destroy:()=>s.destroy()}}}}]);